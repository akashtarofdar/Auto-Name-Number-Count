<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>HF Smart Order - Precise Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@500;700&family=Teko:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #E31E24; --dark: #1e272e; --highlight: #fff9c4; }
        body { font-family: 'Hind Siliguri', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: white; padding: 25px; border-radius: 12px; width: 100%; max-width: 950px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; border-top: 8px solid var(--primary); }
        
        .magic-box { background: #fff4f4; padding: 15px; border-radius: 8px; border: 2px solid #e74c3c; margin-bottom: 20px; }
        .magic-box textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; height: 150px; font-size: 13px; margin-top: 10px; }
        .magic-btn { background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%; font-size: 16px; }
        
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .input-box label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .input-box input, .input-box textarea { width: 100%; padding: 10px; border: 1.5px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        table.entry { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.entry th { background: var(--dark); color: white; padding: 10px; }
        table.entry td { border: 1px solid #eee; padding: 5px; text-align: center; }
        table.entry input { width: 55px; text-align: center; border: 1px solid #ddd; font-weight: bold; }

        #a4-eco-sheet {
            width: 794px; height: 1123px; background: white; padding: 40px;
            display: flex; flex-direction: column; box-sizing: border-box;
            border: 1px solid #ddd; position: absolute; left: -9999px;
        }
        .active-preview #a4-eco-sheet { position: relative; left: 0; margin-top: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        .sheet-header { display: flex; justify-content: space-between; border-bottom: 4px solid var(--primary); padding-bottom: 15px; margin-bottom: 20px; }
        .brand { font-size: 45px; font-weight: 900; color: var(--primary); font-family: 'Teko', sans-serif; line-height: 1; }
        .invoice-tag { background: var(--dark); color: white; padding: 5px 15px; border-radius: 4px; font-family: 'Teko', sans-serif; font-size: 20px; margin-top: 10px; display: inline-block; }

        .main-body { display: grid; grid-template-columns: 240px 1fr; gap: 25px; flex-grow: 1; }
        .side-col { background: #fdfdfd; padding: 15px; border-radius: 8px; border: 1px solid #f0f0f0; display: flex; flex-direction: column; }
        .label-red { font-size: 12px; font-weight: bold; color: white; background: var(--primary); padding: 3px 10px; border-radius: 3px; margin-bottom: 5px; display: inline-block; }
        .stat-val { font-family: 'Teko', sans-serif; font-size: 28px; color: var(--dark); margin-bottom: 10px; line-height: 1; }

        .image-container { width: 100%; border: 1px dashed #ccc; border-radius: 8px; background: #fafafa; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .design-box { height: 260px; }
        .list-box { height: 440px; margin-top: 20px; } 
        .image-container img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .footer { margin-top: auto; border-top: 1px solid #eee; padding-top: 15px; display: flex; justify-content: space-between; align-items: flex-end; }
        .designer-highlight { color: #333; font-size: 15px; border-bottom: 2px solid var(--primary); padding-bottom: 2px; }
        .dl-btn { background: var(--primary); color: white; border: none; padding: 18px; font-size: 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 20px; }
    </style>
</head>
<body class="active-preview">

<div class="admin-panel">
    <h2 style="text-align:center; color:var(--primary);">HF SMART ORDER (STRICT MODE)</h2>

    <div class="magic-box">
        <label><strong>স্মার্ট লিস্ট প্রসেসর:</strong> (হাতা উল্লেখ না থাকলে এটি গণণা করবে না)</label>
        <textarea id="magicInput" placeholder="এখানে লিস্ট পেস্ট করুন..."></textarea>
        <button class="magic-btn" onclick="processMagicList()">Extract Data (Strict)</button>
    </div>
    
    <div class="grid-layout">
        <div class="input-box"><label>ইনভয়েস নম্বর:</label><input type="text" id="inInvoice" oninput="upd()"></div>
        <div class="input-box"><label>কাস্টমার নাম:</label><input type="text" id="inName" oninput="upd()"></div>
        <div class="input-box"><label>ডিজাইনার নাম:</label><input type="text" id="inDesigner" oninput="upd()"></div>
    </div>

    <table class="entry">
        <thead>
            <tr>
                <th>সাইজ</th>
                <th>মোট</th>
                <th>Full (F)</th>
                <th>Half (H)</th>
                <th>Pant (P)</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <div class="grid-layout" style="margin-top:20px">
        <div class="input-box"><label>ডিজাইন ছবি:</label><input type="file" accept="image/*" onchange="previewImg(event, 'outDesignImg')"></div>
        <div class="input-box"><label>লিস্ট ছবি:</label><input type="file" accept="image/*" onchange="previewImg(event, 'outListImg')"></div>
    </div>
    <button class="dl-btn" onclick="downloadPDF()">Download Order Sheet</button>
</div>

<div id="a4-eco-sheet">
    <div class="sheet-header">
        <div>
            <div class="brand">HF SUBLIMATION</div>
            <div class="invoice-tag">INVOICE: <span id="outInvoice">---</span></div>
        </div>
    </div>
    <div style="background:var(--dark); color:white; padding:10px; text-align:center; margin-bottom:20px; font-weight:bold; font-size: 20px; border-radius: 5px;">
        CUSTOMER: <span id="outName">---</span>
    </div>
    <div class="main-body">
        <div class="side-col">
            <div class="label-red">Sleeve Summary</div>
            <div class="stat-val">F: <span id="totF">0</span> | H: <span id="totH">0</span></div>
            <div class="label-red">Size Breakup</div>
            <div id="outSizes" style="font-family:'Teko'; font-size:22px;"></div>
            <div style="margin-top:auto;">
                <div class="label-red">Final Quantity</div>
                <div class="stat-val" style="font-size:35px; color:var(--primary);">JRS: <span id="totJ">0</span></div>
            </div>
        </div>
        <div class="content-col">
            <div class="image-container design-box"><img id="outDesignImg" src=""></div>
            <div class="image-container list-box"><img id="outListImg" src=""></div>
        </div>
    </div>
    <div class="footer">
        <div><span style="font-size: 11px;">Prepared By:</span><br><strong class="designer-highlight" id="outDesigner">---</strong></div>
    </div>
</div>

<script>
    const sizes = ["6XL", "5XL", "4XL", "3XL", "XXL", "XL", "L", "M", "S", "BABY"];
    const tbody = document.getElementById('rows');
    sizes.forEach(s => {
        tbody.innerHTML += `<tr><td><strong>${s}</strong></td><td><input type="number" class="v-total" value="0" readonly></td><td><input type="number" class="v-f" value="0" oninput="upd()"></td><td><input type="number" class="v-h" value="0" oninput="upd()"></td><td><input type="number" class="v-p" value="0" oninput="upd()"></td></tr>`;
    });

    function processMagicList() {
        const text = document.getElementById('magicInput').value.toUpperCase();
        const lines = text.split('\n');
        const inputsF = document.querySelectorAll('.v-f');
        const inputsH = document.querySelectorAll('.v-h');
        
        // Reset inputs
        inputsF.forEach(i => i.value = 0);
        inputsH.forEach(i => i.value = 0);

        lines.forEach(line => {
            if(!line.trim()) return;

            let foundIdx = -1;
            for(let i=0; i<sizes.length; i++){
                let regex = new RegExp("\\b" + sizes[i] + "\\b");
                if(regex.test(line)) { foundIdx = i; break; }
            }

            if(foundIdx !== -1) {
                // কঠোরভাবে হাতা চেক
                const isFull = /FULL|F\/S|FS|FULL HATA|ফুল|F/i.test(line);
                const isHalf = /HALF|H\/S|HS|HAF|HULF|হাফ|H/i.test(line);

                // শুধু তখনই যোগ করবে যখন যেকোনো একটি পাওয়া যাবে
                if(isFull) {
                    inputsF[foundIdx].value = parseInt(inputsF[foundIdx].value) + 1;
                } else if(isHalf) {
                    inputsH[foundIdx].value = parseInt(inputsH[foundIdx].value) + 1;
                }
                // না পাওয়া গেলে কিছুই করবে না (Strict Mode)
            }
        });
        upd();
    }

    function upd() {
        document.getElementById('outInvoice').innerText = document.getElementById('inInvoice').value || "---";
        document.getElementById('outName').innerText = document.getElementById('inName').value || "---";
        document.getElementById('outDesigner').innerText = document.getElementById('inDesigner').value || "---";

        let tf=0, th=0, tj=0, sizeHtml="";
        sizes.forEach((s, i) => {
            let f = parseInt(document.querySelectorAll('.v-f')[i].value) || 0;
            let h = parseInt(document.querySelectorAll('.v-h')[i].value) || 0;
            let rowTotal = f + h;
            document.querySelectorAll('.v-total')[i].value = rowTotal;
            
            if(rowTotal > 0) sizeHtml += `<div>${s}: ${rowTotal}</div>`;
            tf+=f; th+=h; tj+=rowTotal;
        });
        document.getElementById('outSizes').innerHTML = sizeHtml;
        document.getElementById('totF').innerText = tf; 
        document.getElementById('totH').innerText = th;
        document.getElementById('totJ').innerText = tj;
    }

    function previewImg(e, outId) {
        if(!e.target.files[0]) return;
        let r = new FileReader();
        r.onload = () => { document.getElementById(outId).src = r.result; }
        r.readAsDataURL(e.target.files[0]);
    }

    function downloadPDF() {
        html2canvas(document.getElementById('a4-eco-sheet'), { scale: 2 }).then(canvas => {
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);
            pdf.save('OrderSheet.pdf');
        });
    }
</script>
</body>
</html>
